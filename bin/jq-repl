#!/usr/bin/env zsh

_jq_repl() {
# path logic inspired by https://github.com/stedolan/jq/issues/243
jq -r '[
    path(..) |
    map(select(type=="string") // "[]") |
    join(".") | split(".[]") | join("[]")
  ] | map("." + .) | unique | .[]' $1 |
fzf \
    --preview "jq --color-output $JQ_REPL_ARGS {q} $1" \
    --preview-window="down:90%" \
    --height="99%" \
    --query="." \
    --bind "tab:replace-query,return:print-query" \
    --bind "alt-up:preview-page-up,alt-down:preview-page-down"
}

_jq_repl =( if [ "${1:--}" = "-" ] ; then cat ; else < $1 ; fi )
